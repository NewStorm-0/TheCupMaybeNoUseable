%-*- coding: UTF-8 -*-
\documentclass[hyperref,a4paper,UTF8]{ctexart}
\usepackage{geometry}
\usepackage[format=hang,font=small,textfont=it]{caption}
\usepackage[nottoc]{tocbibind}
\usepackage{tocloft}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{longtable}
\usepackage{array}
\usepackage{enumitem}
\usepackage{eqexpl}
\usepackage{tabularx}
\usepackage{listings}
\usepackage{appendix}
\usepackage{color}
\usepackage{ltxtable}
\usepackage{caption}

\geometry{a4paper,centering}
\renewcommand\cftdot{·}
\renewcommand{\cftdotsep}{0}
\bibliographystyle{plain}

\begin{document}
\begin{titlepage}
    \vspace*{\fill}
    \begin{center}
        \normalfont
        %\underline{\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}

        {\Huge\bfseries 2021\mbox{年深圳杯竞赛}B\mbox{题}}

        \bigskip
        %\setlength{\lineskiplimit}{0.2bp}\setlength{\lineskip}{0.2bp}\linespread{0.2}\selectfont
        {\Huge\bfseries 火星探测器着陆控制方案}

        %\underline{\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_}

        \bigskip
        \bigskip
        \bigskip
        \bigskip
        \bigskip
        \bigskip
        \linespread{1.3}\selectfont
        {\Large\heiti 队员：}
        \Large\kaishu
        \begin{tabular}[t]{@{}c}
            朱旭 \\杨雪桐\\吕义春
        \end{tabular}

        \medskip
        {\Large\heiti 指导教师：}
        \Large\kaishu
        \begin{tabular}[t]{@{}c}
            马龙
        \end{tabular}

        \medskip
        \bigskip
        \bigskip
        \normalfont
        2021年8月
    \end{center}
    \vspace{\stretch{3}}
    \begin{center}
        山东大学
    \end{center}
\end{titlepage}
\begin{abstract}
    \stepcounter{page}
    \addcontentsline{toc}{section}{摘要}
    2021年5月15日，我国天问一号探测器成功着陆火星。对我国有着重大的意义。探测器从地球发射到登陆
    火星这一过程中的每一步都困难重重，需要仔细的研究推演才能成功。本文以天问一号为例来研究探测器
    从火星同步轨道出发到探测器在火星地表上方悬停的过程（以下简称着陆过程）。为了解决问题，我们构
    建了一个用来描述探测器着陆过程的数学模型，用来模拟探测器的运动过程。为了高效地模拟该过程，我
    们先提前将各个影响因素分别计算，再观测其影响。经过筛选后，把那些微不足道的影响因素都剔除出去，
    只留下影响比较明显的一些因素。除此之前，又通过查询资料得到一些动作执行的条件，以此来对模型中
    的一些变量进行限制。在此基础上，通过计算求解来得到不同目的下的最优解。

    虽然目前国内有不少关于火星着陆的论文，但是聚焦于这一过程的论文并不多，大多数是研究一个更加精
    细的问题。本文正是基于这些论文来进行进一步的探究。

    问题一中，要求我们得到速度最低的方案。我们根据资料中显示的开伞条件、抛大底条件、抛伞条件与悬
    停高度等信息，采用蒙特卡洛方法，加入一定限制条件，从各个高度进行枚举，在枚举的最后对总时长求
    和并不断更新最短时长及其答案。我们采用变步长法不断缩进范围、精确数值，最终得到最短时长为：
    $20032.969s$​，其对应具体方案详见问题解答。

    问题二中，要求我们获得对给定的着陆过程时间确定消耗能量最少的操控方案。也就是说，我们需要在给
    出总时长的条件下，找出发动机能耗最小的方案，目标从不限能能耗且时间最短，变成了限定时间下能耗
    最小。这需要我们对问题一模型的更新，改变限定条件，增加部分预处理内容，并且改变部分高度的枚举
    范围。最终，我们对于给定时间，在$0.5s$的误差范围内，可以取得发动机的最小能耗及对应的决策方案。
    并且对于部分时长与能耗的关系给出了插值曲线图。

    问题三中，题目要求各阶段尽可能接近公开数据。我们根据公开资料，选定事实依据为气动减速段、伞降
    减速段、动力减速段的时间长度，在前两问的模型基础上，以三个阶段时长分别最接近公开资料显示时长
    为目标，更改限制条件和枚举范围，仍然应用蒙特卡洛方法进行不断枚举迭代，最终获得误差值为
    $119.6078s$ 的最终决策。

    \bigskip
    \bigskip
    \noindent
    \textbf{关键词：} 火星着陆；蒙特卡洛法；开普勒定律；变步长查找法
\end{abstract}
\newpage
\tableofcontents
\newpage
\section{问题重述与分析}
\subsection{问题背景}
探索外太空、解开外星的谜团一直以来是人类的梦想。从古至今人类不曾在这崎岖不平的探索道路中止步。为此，
人类耗费了大量精力财力。2020年，我国发射了托举着“天问一号”的长征五号运载火箭。2021年5月，天问一号
巡视器成功着陆于火星，中国成为了继美国之后全世界第二个成功登陆火星的国家，这意味着我国的航天实力又
提升至了一个新高度。
\subsection{问题重述}
新华社北京 5 月 15 日电：2021 年 5 月 15 日 7 时 18 分，中华人民共和国天问一号探测器成功着陆于
火星乌托邦平原南部预选着陆区，我国首次火星探测任务着陆火星取得成功。中共中央总书记、国家主席、中
央军委主席习近平致贺电，代表党中央、国务院和中央军委，向首次火星探测任务指挥部并参加任务的全体同
志致以热烈的祝贺和诚挚的问候。习近平主席在贺电中指出：%
\textbf{天问一号探测器着陆火星，迈出了我国星际探测征程的重要一步，实现了从地月系到行星际的
    跨越，在火星上首次留下中国人的印迹，这是我国航天事业发展的又一具有里程碑意义的进展。你们勇于挑
    战、追求卓越，使我国在行星探测领域进入世界先进行列，祖国和人民将永远铭记你们的卓越功勋！}

本题聚焦于探测器从火星同步轨道出发到探测器在火星地表上方悬停的过程（以下简称着陆过程），要求参赛队
收集有关天问一号探测器的音像和文字等公开资料，建立数学模型，研究如下问题：
\begin{enumerate}
    \item 确定探测器着陆过程时间最短的操控方案（包括环绕器与着陆巡视器分离、阻尼伞打开、发动机系统
          点火等时间，以及发动机系统运行方案）；
    \item 对给定的着陆过程时间，确定消耗能量最少的操控方案；
    \item 如果希望探测器着陆过程与公开的音像和文字资料尽量一致，如何设计操控方案。
\end{enumerate}
\subsection{问题分析}
天问一号探测器从火星同步轨道出发到在火星地表上方悬停主要有六个阶段：两器分离、进入大气、超音速开伞、
大底分离、背罩分离、悬停成像。

针对问题一，因为不控制探测器落点，所以可以忽略火星的自转以及只考虑一个平面内的运动，所以以探测器降落
火星的椭圆轨道中心为原点建立平面直角坐标系。之后通过蒙特卡洛法来确定各阶段的数据并且用各个阶段的限制
条件加以限制。在网上查阅资料可得这些限制条件。

针对问题二，我们只需要在第一问的基础上进行一些修改并且在其中加入消耗的能量的计算即可。然后再通过蒙
特卡洛法来取得数据。在在一定误差内符合给定时间的数据中比较出消耗能量最少的数据，从而得到相应的操控方
案。

第三问要求决策方案与公开资料尽可能一致，于是我们在第一问和第二问的模型的基础上进行简单的修改，保留
原有的多数基本限制条件，并将为了趋近时间最短和耗能最小的限制去除。在新模型中，模型目标变为各个时间
段的误差值之和 $\sum\Delta t_i$​ 最小，在不以最短时间和最小能耗为目标的条件下，模型的蒙特卡洛枚举
范围增大，且去掉了部分预处理内容。由于公开资料中，具体时间被划分为三个部分：气动减速段，伞降减速
段，动力减速段，因此我们只考虑 $t_2$，$t_3+t_4$，$t_5$ 与真实数据的差值，通过不断迭代更新获取差
值之和的最小值，并记录下最优方案的各个节点高度 $ansh_i$ 和各个阶段时长 $anst_i$。
\section{模型建立}
\subsection{模型假设}
\subsubsection{降落轨道假设}
假设火星为一质量均匀分布的规则球体。由于不控制探测器在火星上的具体落点，所以可以忽略火星的自转。
我们只考虑探测器和火星在一个平面内的运动，所以只需建立一个如图 \ref{pic:syt0} 平面直角坐
标系即可。为了便于探测器的运行轨道的描述和计算，我们以探测器向火星降落的椭圆轨道的中心为原
点，从轨道中心到火星的方向为 x 轴正方向建系。以此坐标系来讨论从同步轨道出发到两器分离的情况。
\begin{figure}[ht!]
    \centering
    \includegraphics[scale=0.45]{建系示意图0.pdf}
    \caption{平面直角坐标系示意图}
    \label{pic:syt0}
\end{figure}
\subsubsection{火星大气模型假设}
目前公开的火星大气数据库分别是欧洲的 MCD 和美国的 Mars-GRAM。但是这些数据库数据量大，不适合直接
进行计算。所以我们用其数据拟合得到的指数模型来描述大气。

我们假设火星大气层的温度相对海拔呈线性变化，压力随着海拔降低呈指数型增长，如图 \ref{pic:xx} 所
示。得到的压力-温度拟合公式为：
\[
    \begin{dcases}
        T = -31 - 0.000998 · H
        \quad
        (T\text{的单位为}^\circ C\text{，}H\text{的单位为}m) \\
        P = 0.699 · e^{-0.00009 · H}
        \quad
        (P\text{的单位为}kPa)
    \end{dcases}
\]
而大气的密度可由以下式子得出：
\[
    \rho = \frac{P}{(T + 273.15)\times 0.1921}
\]
除此之外，我们还可以根据声速的计算式来计算火星上的声速：
\[
    v_c = \sqrt{\kappa RT / M}
\]
上式中，$\kappa $ 为大气绝热指数，在火星上取 $1.29$。$R$ 为通用气体常数，取
$8.314472J/(K·mol)$。$T$ 为大气绝对温度，单位为 $K$。$M$ 为大气平均分子摩尔质量，火星
上取 $43.34\times 10^{-3}kg/mol$。

马赫数的计算公式为：$\displaystyle mahe = \frac{v}{v_c}$
\begin{figure}[ht!]
    \centering
    \includegraphics[scale=0.5]{温度和压强图像.pdf}
    \caption{火星大气温度和压强随高度变化图示}
    \label{pic:xx}
\end{figure}

\subsubsection{探测器假设}
探测器用到燃料的地方有两处：探测器在一开始的变轨阶段以及巡视器在最后的悬停阶段。在这两个阶段
中，消耗的燃料的总质量相比起原先的质量很小。所以我们假设燃料的消耗不会对质量产生任何影响。

\subsection{符号说明}
\begin{longtable}[h]{|c|p{10cm}|}
    \hline
    \bfseries 符号     & \multicolumn{1}{c|}{\bfseries 说明}                    \\
    \endhead
    \hline
    \bfseries 符号     & \multicolumn{1}{c|}{\bfseries 说明}                    \\
    \endfirsthead
    \multicolumn{2}{c}{\itshape 接下一页表格······}
    \endfoot
    \endlastfoot
    \hline
    $a$                & 椭圆轨道半长轴                                         \\
    \hline
    $b$                & 椭圆轨道半短轴                                         \\
    \hline
    $c$                & 椭圆轨道的焦距的{}$\frac{1}{2}$                        \\
    \hline
    $h$                & 两器分离时的位置到火星表面的距离                       \\
    \hline
    $h_1$              & 远火点到火星表面的距离                                 \\
    \hline
    $h_2$              & 近火点到火星表面的距离                                 \\
    \hline
    $h_3$              & 巡视器打开降落伞时高度                                 \\
    \hline
    $h_4$              & 巡视器大底分离时高度                                   \\
    \hline
    $h_5$              & 巡视器背罩分离时高度                                   \\
    \hline
    $h_6$              & 巡视器开启发动机时高度                                 \\
    \hline
    $r$                & 火星半径，为 $3396200m$                                \\
    \hline
    $x_0$              & 两器分离时的横坐标                                     \\
    \hline
    $y_0$              & 两器分离时的纵坐标                                     \\
    \hline
    $x$                & 椭圆轨道上任意一点横坐标                               \\
    \hline
    $y$                & 椭圆轨道上任意一点的纵坐标                             \\
    \hline
    $T_0$              & 火星同步轨道的周期，为$24\times 60\times 60 + 37\times
    60 + 22.7s$                                                                 \\
    \hline
    $T_1$              & 椭圆轨道上的周期                                       \\
    \hline
    $M$                & 火星的质量，为$6.4171\times 10^{23}kg$                 \\
    \hline
    $G$                & 引力常量，为$6.67\times 10^{-11}N·m^2/kg^2$            \\
    \hline
    $S$                & 探测器与火星的连线从远火点到两器分离时扫过的面积       \\
    \hline
    $S_1$              & 椭圆轨道的面积                                         \\
    \hline
    $S_{\text{floor}}$ & 大底的底面积，为$2^2·\pi m^2$                          \\
    \hline
    $S_{\text{para}}$  & 降落伞打开后的面积，为$200m^2$                         \\
    \hline
    $v_0$              & 巡视器两器分离时的速度                                 \\
    \hline
    $t_1$              & 从同步轨道到两器分离的时间                             \\
    \hline
    $t_2$              & 从两器分离到打开降落伞的时间                           \\
    \hline
    $t_3$              & 从降落伞打开到大底分离的时间                           \\
    \hline
    $t_4$              & 从大底分离到背罩分离的时间                             \\
    \hline
    $t_5$              & 从背罩分离到悬停成像的时间                             \\
    \hline
    $t_6$              & 巡视器悬停成像花费的时间                               \\
    \hline
    $m$                & 巡视器的质量，为 $1285kg$                              \\
    \hline
    $m_{\text{floor}}$ & 大底的质量，为 $89.6kg$                                \\
    \hline
    $m_{\text{para}}$  & 降落伞的质量，为 $38kg$                                \\
    \hline
    $m_{\text{hide}}$  & 背罩的质量，为 $245.3kg$                               \\
    \hline
    $F_{\text{eng}}$   & 巡视器发动机的推力                                     \\
    \hline
    \caption{模型符号说明}
\end{longtable}
\subsection{开始建立}
\subsubsection{两器分离阶段}
先来讨论第一阶段---两器分离阶段。探测器先从同步轨道上减速变轨到椭圆轨道。当探测器飞行到近日点
附近时，进行两器分离。环绕器继续绕轨道飞行，着陆巡视器继续向火星降落，脱离了之前的轨道。显然可得：
\[
    \begin{dcases}
        \frac{x^2}{a^2} + \frac{y^2}{b^2} = 1 ; \\
        c^2 = a^2 - b^2;                        \\
        a + c = h_1 + r;                        \\
        a - c = h_2 + r.                        \\
    \end{dcases}
\]
解上面的方程组可得：
\[
    \begin{dcases}
        a = (h_1 + h_2 + 2·R) / 2; \\
        b = \sqrt{a^2 - c^2};      \\
        c = (h_1 - h_2) / 2.       \\
    \end{dcases}
\]

\noindent 根据几何关系及开普勒定律可得：

\[
    \begin{dcases}
        x_0 = \frac{a^2}{c} - \frac{a(h + r)}{c}; \\
        y = \sqrt{b^2 - \frac{b^2}{a^2}x^2};      \\
        S = \int_{-a}^{x^0} y \,dx                \\
        S_1 = \pi · a · b                         \\
        t_1 = \frac{S}{S_1} · T_1
    \end{dcases}
\]
在迭代过程中得到不同的 $h_2$ 和 $h$ 对应的巡视器从同步轨道出发到两器分离的时长 $t_1$，
并将 $t_1$ 作为迭代过程量进一步计算。

\subsubsection{进入大气阶段}
在此阶段中，巡视器的受力主要为火星对其的重力和空气摩檫力。该阶段是巡视器主要减速阶段。为了便于研究，
将巡视器速度分为相对于火星地面的垂直速度与水平速度。此时，需要一个火星地面的基准。假设两器分离的点
就位于火星地面的垂直上方，这就是我们选取的基地面。

为了进行速度的转化，需要先求得原先速度相对于坐标系的斜率 $k$，计算$k$的方法为：
对 $y = \sqrt{b^2 - \frac{b^2}{a^2}x^2}$ 求导，然后代入 $x$ 便得到 $k$。
再由几何关系可以得到，向量 $(x_0 - c, y_0)$ \smallskip 和向量 $(1,k)$ 的夹角 $\theta = \arccos
    \frac{\displaystyle (x_0 - c, y_0)·(1,k)}{\displaystyle\vert (x_0 - c, y_0)\vert \cdot |(1,k)|} $。

\smallskip
可以通过能量守恒求得 $v_0$：
\[
    v_0 = \sqrt{\frac{2\,G\,M\,{\left(R+h_1 \right)}}
        {{\left(R+h\right)}\,{\left(2\,R+h+h_1 \right)}}}
\]

利用 $\theta $ 可求出相对于火星地面的垂直速度 $v_{y0}$ 与水平速度 $v_{x0}$：
\begin{gather*}
    v_{x0} = \cos (\frac{\pi }{2} - \theta ) \cdot v_0 \\
    v_{y0} = \sin (\frac{\pi }{2} - \theta ) \cdot v_0
\end{gather*}

利用动能定理，结合离散化可以得到不同高度之间速度的递推公式：
\begin{equation}\label{eq:atmos}
    \begin{dcases}
        \frac{1}{2}mv_{y_{i + 1}}^2 = \frac{1}{2}mv_{y_{i}}^2 + mg\Delta h -
        \frac{1}{2}\rho _iv_i^2S_{\text{floor}}\Delta h\frac{v_{y_i}}{v_i}                        \\
        \frac{1}{2}mv_{x_{i + 1}}^2 = \frac{1}{2}mv_{x_{i}}^2 + mg\Delta h -
        \frac{1}{2}\rho _iv_i^2S_{\text{floor}}\Delta h\frac{v_{x_i}}{v_i}\frac{v_{x_i}}{v_{y_i}} \\
        v_i^2 = v_{x_i}^2 + v_{y_i}^2
    \end{dcases}
\end{equation}
\eqexplSetIntro{\qquad 式中，\ }
\begin{eqexpl}[0mm]
    %\itshape\footnotesize
    \item{$\Delta h$} 离散化中的梯度值
    \item{$\rho$} 针对每个节点高度计算得到的大气密度
\end{eqexpl}
\smallskip

对每个高度段计算时长，并累加得到
$
    \displaystyle t_2=\sum_{i=h}^{h_3}{\displaystyle\frac{\Delta h}{\frac{\displaystyle v_i}
        {\displaystyle 2}+\frac{\displaystyle v_{\textrm{i+1}} }{\displaystyle 2}}}
$

\subsubsection{超音速开伞阶段}
此阶段较进入大气阶段差别不大，不同之处在于巡视器还受到了降落伞带来的空气阻力。相比上一阶段，该阶段的
加速度更大，也就是减速更快。为了减少花费的时间，我们应尽量让巡视器在进入大气阶段---开伞之前减速。这
样，巡视器的平均速度才会尽可能大，花费的时间也才会尽可能少。此阶段的限制条件为：
\begin{itemize}
    \item 开伞马赫数：$1.6$--$2.3$; 
    \item 开伞高度：$4$--$15km$;
\end{itemize}
得到的递推公式为：
\[
    \begin{dcases}
        \frac{1}{2}mv_{y_{i + 1}}^2 = \frac{1}{2}mv_{y_{i}}^2 + mg\Delta h -
        \frac{1}{2}\rho _iv_i^2(S_{\text{floor}}+S_{\text{para}})\Delta h\frac{v_{y_i}}{v_i} \\
        \frac{1}{2}mv_{x_{i + 1}}^2 = \frac{1}{2}mv_{x_{i}}^2 + mg\Delta h -
        \frac{1}{2}\rho _iv_i^2(S_{\text{floor}}+S_{\text{para}})\Delta h\frac{v_{x_i}}{v_i}
        \frac{v_{x_i}}{v_{y_i}}                                                              \\
        v_i^2 = v_{x_i}^2 + v_{y_i}^2
    \end{dcases}
\]

对每个高度段计算时长，并累加得到
$
    \displaystyle t_3=\sum_{i=h_3}^{h_4}{\displaystyle\frac{\Delta h}{\frac{\displaystyle v_i}
        {\displaystyle 2}+\frac{\displaystyle v_{\textrm{i+1}} }{\displaystyle 2}}}
$

\subsubsection{大底分离阶段}
此阶段与超音速开伞阶段类似，区别在于此阶段没有大底的质量。
得到的递推公式为：
\[
    \begin{dcases}
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}})v_{y_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}})v_{y_{i}}^2 +
            (m-m_{\text{floor}})g\Delta h \\ &\quad - \frac{1}{2}\rho
            _iv_i^2(S_{\text{floor}}+S_{\text{para}})
            \Delta h\frac{v_{y_i}}{v_i}
        \end{split}
        \\
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}})v_{x_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}})v_{x_{i}}^2 +
            (m-m_{\text{floor}})g\Delta h \\ &\quad -\frac{1}{2}
            \rho _iv_i^2(S_{\text{floor}}+S_{\text{para}})\Delta h
            \frac{v_{x_i}}{v_i}\frac{v_{x_i}}{v_{y_i}}
        \end{split}
        \\
        v_i^2 = v_{x_i}^2 + v_{y_i}^2 \\
    \end{dcases}
\]

对每个高度段计算时长，并累加得到
$
    \displaystyle t_4=\sum_{i=h_4}^{h_5}{\displaystyle\frac{\Delta h}{\frac{\displaystyle v_i}
        {\displaystyle 2}+\frac{\displaystyle v_{\textrm{i+1}} }{\displaystyle 2}}}
$

\subsubsection{背罩分离阶段}
这一阶段同进入大气阶段相似，区别在于没有大底、背罩和降落伞的质量。该阶段的限制条件为：降落伞脱除时：高
度 $0km$ 时，速度不大于 $95m/s$。可得出的递推公式为：
\[
    \begin{dcases}
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})v_{y_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            v_{y_{i}}^2 \\ &\quad + (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            g\Delta h\\ &\quad -\frac{1}{2}\rho _iv_i^2
            S_{\text{floor}}\Delta h\frac{v_{y_i}}{v_i}
        \end{split}
        \\
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})v_{x_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            v_{x_{i}}^2 \\ &\quad + (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            g\Delta h \\ &\quad -\frac{1}{2}\rho _iv_i^2S_{\text{floor}}\Delta h
            \frac{v_{x_i}}{v_i}\frac{v_{x_i}}{v_{y_i}}
        \end{split}
        \\
        v_i^2 = v_{x_i}^2 + v_{y_i}^2
    \end{dcases}
\]

对每个高度段计算时长，并累加得到
$
    \displaystyle t_5=\sum_{i=h_5}^{h_6}{\displaystyle\frac{\Delta h}{\frac{\displaystyle v_i}
        {\displaystyle 2}+\frac{\displaystyle v_{\textrm{i+1}} }{\displaystyle 2}}}
$

\subsubsection{悬停成像阶段}
最后一阶段是悬停成像阶段。在该阶段中，巡视器先自由下落，然后开启发动机，开始减速，最后悬停。此阶段
与背罩分离阶段相似，不同之处在于途中开启了发动机来减速，受到发动机给的推力。此阶段是六个阶段中最后
的减速阶段。因为巡视器在到达此阶段时速度较小，所以受到的空气阻力也较小，主要靠开启发动来减速。同超
音速开伞阶段相似，该阶段也尽量让平均速度较高但同时还得保证巡视器最后可以减速为$0m/s$。因此巡视器应
该在较低的高度开启发动机最大推力保持不变，直至悬停。而在开启之前，只需让巡视器自由下落。该阶段得到
的拟合公式为：
\[
    \begin{dcases}
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})v_{y_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            v_{y_{i}}^2 \\ &\quad + (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            g\Delta h\\ &\quad -\frac{1}{2}\rho _iv_i^2S_{\text{floor}}\Delta h
            \frac{v_{y_i}}{v_i} - F_{\text{eng}}·\frac{\Delta hv_{y_i}}{v_i}
        \end{split}
        \\
        \begin{split}
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})v_{x_{i + 1}}^2 &=
            \frac{1}{2}(m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            v_{x_{i}}^2 \\ &\quad + (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})
            g\Delta h \\ &\quad -\frac{1}{2}\rho _iv_i^2S_{\text{floor}}\Delta h
            \frac{v_{x_i}}{v_i}\frac{v_{x_i}}{v_{y_i}} -
            F_{\text{eng}}·\frac{\Delta hv_{x_i}}{v_{y_i}}·\frac{v_{x_i}}{v_i}
        \end{split}
        \\
        v_i^2 = v_{x_i}^2 + v_{y_i}^2
    \end{dcases}
\]

对每个高度段计算时长，并累加得到
$
    \displaystyle t_6=\sum_{i=h_6}^{100m}{\displaystyle\frac{\Delta h}{\frac{\displaystyle v_i}
        {\displaystyle 2}+\frac{\displaystyle v_{\textrm{i+1}} }{\displaystyle 2}}}
$

\subsection{稳定性分析}
$\mathrm{d}h$ 的取值影响着模型的稳定性，现在对于不同 $\mathrm{d}h$ 的取值对于结果影响的大小。
通过计算不同 $\mathrm{d}h$ 在着陆器降落至 $4000m$（未开伞）的速度可得到图 \ref{pic:sta}。
标准差为 $2.3169m/s$，均值为 $444.4440m/s$，误差小于 $1\%$，说明该模型具有良好的稳定性。
\begin{figure}[ht!]
    \centering
    \includegraphics[scale=0.5]{稳定性的图.pdf}
    \caption{}
    \label{pic:sta}
\end{figure}

\section{问题解答}
\subsection{第一问的解}
为了缩短时间，我们需要对一些具体情况进行讨论。
\begin{enumerate}
    \item 最短时间上降落伞开伞位置的处理：\par
    为了获得最短EDL时间，需要使得整个过程在各个高度上的速度的平均值最小，开伞之后由于巨大的阻力作用，
    使得开伞后速度快速下降，整体速度的平均值也快速下降，为此，我们希望开伞的高度尽可能低，以使我们的
    高度速度图像的面积尽可能大。
    \item 最短时间时发动机的控制：\par
    为了时间最短需要速度平均值最大，当发动机越晚启动，速度平均值越大，但越晚启动在高度为 $100m$ 处，
    越难使速度减为 $0$，在减速过程中，发动机推力越大，减速越容易。
\end{enumerate}
\begin{figure}[ht!]
    \centering
    \includegraphics[scale=0.5]{question1.pdf}
    \caption{开伞前后速度变化图（图中数值计算以 $4000m$ 开伞为例）}
    \label{pic:v}
\end{figure}

综上所述，在发动机减速阶段，我们使发动机尽可能晚启动，并启动时即为 $7500N$ 的最大推力，最后判断
$100m$ 高度时是否减速至 $0$。
计算结果时将各个区间段的时间求和得到总时长 $t$，并记录下每段时间的时长和节点高度以便于制定方案：
\[
    t = \sum_{i=1}^{6}t_i
\]

总时长 $t$ ​​在迭代过程中不断比较并更新为最小值，同时更新与之对应的区间时长 $t_i$ 和接点高度 $h_i$：
\begin{gather*}
    t_{\text{ans}}=\min\{{t_{k=1},t_{k=2},...,t_{k=N}}\}\\
    (\text{\itshape 假设总共迭代次数为}N)\\
    h_{\text{ansj}} = h_{k=\text{ans}_i,j}~
    (j=1,2,3,..6)\\
    t_{\text{ansj}} = t_{k=\text{ans}_i,j}~
    (j=1,2,3,..6)
\end{gather*}
经过不同步长的迭代，最终得到最优解 $t_{\text{ans}} = 20032.969s$。此时部分变量的取值如
表 \ref{tab:0}。
\bigskip
\bigskip
\bigskip
\LTXtable{14cm}{表1}

\subsection{第二问的解}
第二问的研究范围同第一问一样，都是探测器从同步轨道出发到巡视器在火星表面上方悬停。所以我们可以在第
一问的模型基础上进行适度修改：
\begin{enumerate}
    \item 本问并不追求缩短时间的消耗，所以需要对 $h_3$ 在一定范围内利用蒙特卡洛法来确定数值。
    \item 消耗的能量主要集中在最后的悬停成像阶段。所以我们仍可以使用之前的方法，只需要在最后
          一阶段---悬停成像阶段中加入对消耗的能量的计算。
    \item 为了减少能量的消耗，巡视器的发动机应该在背罩分离后立刻全力开启以减速。因为如果巡视
          器在发动机开启之前进行加速下降的话，那么发动机需要消耗更多能量来减速。所以 $h_5 = h_6$。
          如果发动机不是一直最大推力开启的话，那么巡视器会下降更多距离，更多的重力势能会转化为
          动能，抵消这些能量会消耗更多的燃料。
\end{enumerate}

在第二问中，有一些情况需要我们来细致讨论一下：
\begin{enumerate}
    \item 降落伞开伞条件的控制：\par
    利用马赫数和高度的限制，再利用式（\ref{eq:atmos}）可求出开伞高度的上下限，但由于开伞高
    度对后面的影响过于复杂，故采用蒙特卡洛法对于开伞高度进行打把。
    \item 抛背罩以及开发动机的控制：\par
    发动机能耗 $E = E_k + mgh - E_f$，$E_k$ 为开启发动机时刻的着陆器动能，$mgh$ 为着陆器到
    $100m$ 高的势能差，$E_f$ 为阻力做功。于是应该使开启发动机时刻的速度与高度尽可能小，为此应
    将抛降落伞高度尽可能小，同时这样也可使速度尽可能小。而此后发动机开启前如果有自由落体部分，
    不如将自由落体部分换成开伞部分。所以抛背罩的时间与发动机开启时间相同。如果发动机开启后有匀
    速下降阶段，说明发动机减速过于充分，应该再降低抛背罩的高度。
\end{enumerate}

综上所述，在抛背罩时开发动机，并且发动机应以 $7500N$ 最大推力在 $100m$ 高度处使着陆器速度正好
减至 $0m/s$。

经计算获得：在发动机开启后的这段时间中，阻力做功 $W_f$ 远小于发动机做功 $W_E$ 和重力做功
$W_G$。因此，在发动机即将开启的时刻，利用能量守恒定理，使用当前的速度 $v_x$，$v_y$ 及高度差
$h-h_{100m}$ ​计算获得这一阶段发动机的能耗 $E$：
\begin{equation*}
    \begin{split}
        E &= \frac{1}{2}(v_x^2+v_y^2)\times (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}}) \\
        &\quad + (m-m_{\text{floor}}-m_{\text{para}}-m_{\text{hide}})\times g\times (hh-100)
    \end{split}
\end{equation*}

通过计算先算出了两组对于给定时长所得出的能量消耗最少的方案。第一组给定的着陆过程时间为 $20200s$，
具体数值如表 \ref{tab:1} 所示。第二组给定的着陆过程时间为 $20100s$，具体数值如表
\ref{tab:2} 所示。
\LTXtable{14cm}{表2}
\LTXtable{14cm}{表3}
\begin{figure}[hbt!]
    \centering
    \includegraphics[scale=0.6]{问题2图像.pdf}
    \caption{总降落时长和能量消耗关系图}
    \label{pic:ans2}
\end{figure}
之后计算出大量时长对应的最小能耗。根据计算结果得到总降落时长和能耗的关系如图 \ref{pic:ans2} 所示。
由图\ref{pic:ans2} 最后数值趋于一个固定值，可知，随着时间的延长，可以得到一个最优解，使得能量消耗
为固定最小值。
\subsection{第三问的解}
第三问在搜集公开资料的过程中，通过比较资料的完整程度决定使用三大阶段的时间长度作为目标，
它们分别是：气动减速段 $T_1 = 279s$，伞降减速段 $T_2=168s$，动力减速段 $T_3=90s$​。
由此，我们将前两文的模型融合，在保证基本条件满足的基础上，以追求贴近公开资料的实际数据
为目标，进行如下改动：
\begin{enumerate}
    \item 根据实际资料中抛伞和背罩与发动机点火是同时进行的，对于 $h_5$ 与 $h_6$ 的处
    理，我们选择了同第二问一样的合并，并取 $t_5$​​​ 为发动机点火到悬停成像的时间。
    \item 根据实际数据中发动机采取先将速度减速到 $1.5m/s$ 然后缓缓下降这一步骤，模型
    在 $t_5$ ​阶段的处理变为当速度下降到 $1.5m/s$ 时退出循环，并将剩余运动以匀速运动
    的形式进行，将匀速运动时间加入到 $t_5$ 中。这里之所以将剩余部分看作匀速运动，是因
    为在发动机允许功率作用下，经计算获得，探测器速度从 $1.5m/s$ 下降为 $0$ 所需要的时
    间比较 $t_5$ 可以忽略不计。
    \item 在每一个阶段获取 $t_i$ 后，根据已知数据进行比较，得到
    $\Delta t_1 = |t_2 - T_1|$，$\Delta t_2 = |(t_3+t_4) - T_2|$，
    $\Delta t_3 = |t_5 - T_3|$，最后求和获得
    $\Delta t = \Delta t_1 + \Delta t_2 + \Delta t_3$。对于获得的总误差 $\Delta t$，
    每次更新它的最小值，同时通过 $ansh_i$ 和 $anst_i$ 记录下最优方案的各个节点高度和
    各个阶段时长。
    \item 每个阶段的枚举均在条件允许内达到最大值以尽可能找全情况、优化总误差
    $\Delta t$。其中，包括：
        \begin{enumerate}
            \item 近火点高度 $h_2$ 从 $0$ 开始枚举；
            \item 进入大气的高度 $h$ 从认为大气出现的最低高度 $10000m$ 开始枚举，一
            直枚举到大气可近似认为消失的最大高度 $200000m$；
            \item 打开降落伞的高度 $h_3$ 用在 $h$ 和 $h_2$ 条件下根据马赫数确定的最
            大范围 $[h_min,h_max]$ 进行枚举；
            \item 抛掉大底的高度 $h_4$ 依然用马赫数确定；
            \item 抛掉降落伞同时打开发动机的高度 $h_5$ 在 $100m$ 到 $h_4$ 之间进行枚
            举。这里不再加入最低高度 $hhmin$ 来保证探测器可以在 $100m$ 处速度下降为
            $0$，是因为当速度达到 $1.5m/s$ ​时直接退出循环进入匀速阶段，如果此时高度低
            于悬停指定高度 $100m$，就不参与最优解的更新，直接进入下一个 $h_2$ 的循环。
        \end{enumerate}
\end{enumerate}

通过向公开数据优化的模型，我们得到本模型最小总误差为：$min\Delta t = 119.6078s$，对应
的决策如表 \ref{tab:3} 。
\LTXtable{14cm}{表4}
\newpage
\nocite{庞之浩2021}
\nocite{黄翔宇2021}
\nocite{冯伟2021}
\nocite{王敏2013}
\nocite{张青斌2017}
\nocite{陈正2020}
\nocite{唐明章2021}
\nocite{滕锐2016}
\nocite{邱晨辉2021}
\nocite{胡志丹2021}
\nocite{杨璐2020}
\nocite{宋叶志2019}
\nocite{Null2021}
\bibliography{references}
\section*{附录}
\addcontentsline{toc}{section}{附录}
\appendix
\section{第一问MATLAB代码}
\subsection{求解代码}
\lstset{
    basicstyle=\sffamily,
    keywordstyle=\bfseries,
    commentstyle=\rmfamily\itshape,
    stringstyle=\ttfamily,
    columns=flexible,
    numbers=left,
    numberstyle=\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}
\begin{lstlisting}[language=Matlab]
%经过多次变步长，可以得到以下代码
clear;
clc;

T = @(hh) -31 - 0.000998 * hh; %温度
phi = @(p, t) p / (0.1921 * (t + 273.15)); %密度
p = @(hh) 0.699 * exp(-0.00009 * hh); %压强
q = @(pho, v) 0.5 * pho * v^2; %动压

M = 6.4171 * 10^23;
R = 3396.2 * 1000;
G = 6.67 * (10^(-11));
g = M * G / (R^2);

T0 = 24 * 60 * 60 + 37 * 60 + 22.7; %同步轨道的周期
h1 = ((M * G * (T0^2)) / (4 * (pi^2)))^(1/3) - R;

m = 1285;
m_floor = 89.6; %火星着陆探测进入与减速段动力学问题研究
m_hide = 245.3;
m_para = 38;
S_floor = 2^2 * pi;
S_para = 114;

t = inf;
t1 = 0;
t2 = 0;
t3 = 0;
t4 = 0;
t5 = 0;
anst1 = -1;
anst2 = -1;
anst3 = -1;
anst4 = -1;
anst5 = -1;
ansh4 = 0;
ansh3 = 0;
ansh2 = 0;
ansh = 0;
%hmax = 4700;%待会计算完了进行更改
%hmin = 3990;%待会计算完了进行更改
hhmin = inf;

%clear all, clc;
%h1 = h1;
for h2 = 0:10000:0
    %椭圆轨道的几何关系
    a = (h1 + h2 + 2 * R) / 2;
    c = (h1 - h2) / 2;
    b = sqrt(a^2 - c^2);
    T1 = 2 * pi * ((a^3) / (M * G))^(1/2); %椭圆轨道的周期
    diffk = @(x) -(b^2 * x) / (a^2 * (b^2 - (b^2 * x^2) / a^2)^(1/2));
            %y对于x的求导函数

    for h = 100000:10000:100000
        %t1部分:
        x0 = abs((a^2 / c) - (a * (h + R)) / c);
        y = @(x)sqrt(abs(b^2 - (x .* b ./ a).^2));
        S = integral(y, -a, x0) - 0.5 * (x0 - c) * sqrt(y(x0));
        S_ = pi * a * b;
        t1 = S / S_ * T1;

        %t2部分
        t2 = 0;
        hh = h;
        dh = 0.1;
        k = diffk(x0);
        theta = acos((x0 - c + y(x0) * k) / (sqrt(x0^2 - 2 * x0 * c + c^2 + y(x0)^2) * sqrt(1 + k^2))) - pi / 18;
        v_0 = 2^(1/2) * ((G * M * (R + h1)) / ((R + h) * (2 * R + h + h1)))^(1/2);
        v_yy = sin(0.5 * pi - theta) * v_0;
        v_xx = cos(0.5 * pi - theta) * v_0;

        hh2 = hh;
        hmax = 0;
        hmin = inf;
        v_yy2 = v_yy; v_xx2 = v_xx;

        while hh2 >= 0
            v_y2 = sqrt(v_yy2^2 + 2 * g * dh - phi(p(hh2), T(hh2)) 
                   * sqrt(v_yy2^2 + v_xx2^2) * S_floor * dh * v_yy2 / m);

            if abs(v_y2) < 1
                v_y2 = 1;
            end

            v_x2 = sqrt(v_xx2^2 - phi(p(hh2), T(hh2)) * sqrt(v_xx2^2 + v_yy2^2) * S_floor * dh * v_xx2^2 / (m * v_yy2));

            if abs(v_x2) < 1
                v_x2 = 1;
            end

            hh2 = hh2 - dh;
            v_yy2 = v_y2;
            v_xx2 = v_x2;
            vc = sqrt(1.29 * (T(hh2) + 273.15) * 8.314472 * 1000/43.34);
            mahe = sqrt(v_x2^2 + v_y2^2) / vc;
            p_move = q(phi(p(hh2), T(hh2)), sqrt(v_xx2^2 + v_yy2^2));

            if mahe >= 1.6 && mahe <= 2.3 % && p_move <= 850 && p_move >= 250
                hmin = min(hmin, hh2);
                hmax = max(hmax, hh2);
            end

        end

        hmax = min(hmax, 15000);
        hmin = max(hmin, 4000);

        if hmax < hmin
            continue
        end

        h3 = hmin;

        while hh >= h3
            flagt2 = 10086;
            v_y = sqrt(v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_yy / m);

            if abs(v_y) < 1
                v_y = 1;
            end

            v_x = sqrt(v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * S_floor * dh * v_xx^2 / (m * v_yy));

            if abs(v_x) < 1
                v_x = 1;
            end

            hh = hh - dh;
            t2 = t2 + dh / ((v_y + v_yy) / 2);
            v_yy = v_y;
            v_xx = v_x;
        end

        %t3部分
        t3 = 0;

        while sqrt(v_yy^2 + v_xx^2) > 95
            %到速度减小到一定值时可以丢走降落伞,但这只是一个大的限制条件，更进一步的条件是马赫数
            v_y = sqrt(v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / m);

            if abs(v_y) < 1
                v_y = 1;
            end

            v_x = sqrt(v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / (m * v_yy));

            if abs(v_x) < 1
                v_x = 1;
            end

            hh = hh - dh;
            t3 = t3 + dh / ((v_y + v_yy) / 2);
            v_yy = v_y;
            v_xx = v_x;
            vc = sqrt(1.29 * (T(hh) + 273.15) * 8.314472 * 1000/43.34);
            mahe = sqrt(v_x^2 + v_y^2) / vc;
            %没错就是这里马赫数起到真正的限制作用,达到之后就可以丢掉大底了
            if mahe <= 0.6
                h4 = hh;
                break
            end

        end

        dh = 0.1;
        tmp_hh = hh;

        for h5 = 111.3:1:111.3
            %t4部分
            hh = tmp_hh;
            t4 = 0;

            while hh >= h5 %到速度减小到一定值时可以丢走降落伞
                flag1 = 98;
                tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / (m - m_floor);

                if tmpvy2 < 1
                    tmpvy2 = 1;
                end

                v_y = sqrt(tmpvy2);
                tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / ((m - m_floor) * v_yy);

                if tmpvx2 < 0.1
                    tmpvx2 = 0;
                end

                v_x = sqrt(tmpvx2);
                hh = hh - dh;
                dt = dh / ((v_y + v_yy) / 2);
                t4 = t4 + dt;
                flag2 = 1;
                v_yy = v_y;
                v_xx = v_x;
            end

            if (v_yy^2 + v_xx^2) >= 95^2
                continue;
            end

            tmp_hh2 = hh;

            for h6 = 110:0.1:h5
                v_yy3 = v_yy;
                v_xx3 = v_xx;
                %t5部分预处理
                hh = tmp_hh2;
                %开发动机之前
                while hh >= h6
                    tmpvy32 = v_yy3^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * (S_floor + S_para) * dh * v_yy3 / (m - m_floor - m_para - m_hide);

                    if tmpvy32 < 1
                        tmpvy32 = 1;
                    end

                    v_y3 = sqrt(tmpvy32);
                    tmpvx32 = v_xx3^2 - phi(p(hh), T(hh)) * sqrt(v_xx3^2 + v_yy3^2) * (S_floor + S_para) * dh * v_xx3^2 / ((m - m_floor - m_para - m_hide) * v_yy3);

                    if tmpvx32 < 0.1
                        tmpvx32 = 0;
                    end

                    v_x3 = sqrt(tmpvx32);
                    hh = hh - dh;
                    v_yy3 = v_y3;
                    v_xx3 = v_x3;
                end

                while hh >= 100
                    tmpvy32 = v_yy3^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * S_floor * dh * v_yy3 / (m - m_floor - m_para - m_hide) - 2 * 7500 * dh * v_yy3 / ((m - m_floor - m_para - m_hide) * sqrt(v_yy3^2 + v_xx3^2));
                    tmpvx32 = v_xx3^2 - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * S_floor * dh * v_xx3^2 / (v_yy3 * (m - m_floor - m_para - m_hide)) - 2 * 7500 * dh * v_xx3^2 / (v_yy3 * sqrt(v_yy3^2 + v_xx3^2) * (m - m_floor - m_para - m_hide));

                    if tmpvy32 < 1 && tmpvx32 < 1
                        hhmin = min(hhmin, h6);
                        break;
                    end

                    v_y3 = sqrt(tmpvy32);
                    v_x3 = sqrt(tmpvx32);
                    hh = hh - dh;
                    v_yy3 = v_y3;
                    v_xx3 = v_x3;
                end

                %if v_yy3>1||v_xx3>0
                %    continue
                %end
            end

            %t5部分正式计算
            t5 = 0;
            dh = 0.1;
            hh = tmp_hh2;
            %开发动机之前
            while hh >= hhmin
                tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / (m - m_floor - m_para - m_hide);

                if tmpvy2 < 1
                    tmpvy2 = 1;
                end

                v_y = sqrt(tmpvy2);
                tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / ((m - m_floor - m_para - m_hide) * v_yy);

                if tmpvx2 < 1
                    tmpvx2 = 1;
                end

                v_x = sqrt(tmpvx2);
                hh = hh - dh;
                dt = dh / ((v_y + v_yy) / 2);
                t5 = t5 + dt;
                v_yy = v_y;
                v_xx = v_x;
            end

            %开发动机之后
            while hh >= 100
                tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_yy / (m - m_floor - m_para - m_hide) - 2 * 7500 * dh * v_yy / ((m - m_floor - m_para - m_hide) * sqrt(v_yy^2 + v_xx^2));
                tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_xx^2 / (v_yy * (m - m_floor - m_para - m_hide)) - 2 * 7500 * dh * v_xx^2 / (v_yy * sqrt(v_yy^2 + v_xx^2) * (m - m_floor - m_para - m_hide));

                if tmpvy2 < 1
                    tmpvy2 = 1;
                end

                v_y = sqrt(tmpvy2);

                if tmpvx2 < 1
                    tmpvx2 = 1;
                end

                v_x = sqrt(tmpvx2);
                dt = dh / ((v_y + v_yy) / 2);
                t5 = t5 + dt;
                hh = hh - dh;
                v_yy = v_y;
                v_xx = v_x;
            end

            tmpt = t1 + t2 + t3 + t4 + t5

            if t1 == 0 || t2 == 0 || t3 == 0 || t4 == 0 || t5 == 0
                continue
            end

            if tmpt < t
                t = tmpt;
                ansh6 = h6;
                ansh5 = h5;
                ansh4 = h4;
                ansh3 = h3;
                ansh2 = h2;
                ansh = h;
                anshh = hh;
                anst1 = t1;
                anst2 = t2;
                anst3 = t3;
                anst4 = t4;
                anst5 = t5;
            end

        end

    end

end

t
ansh2 %近火点的高度
ansh %进入大气的高度
ansh3 %开启降落伞的高度
anst1
anst2
anst3
anst4
anst5
ansh4
ansh5
ansh6

\end{lstlisting}
\subsection{绘图代码}
\lstset{
    basicstyle=\sffamily,
    keywordstyle=\bfseries,
    commentstyle=\rmfamily\itshape,
    stringstyle=\ttfamily,
    columns=flexible,
    numbers=left,
    numberstyle=\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}
\begin{lstlisting}[language=Matlab]
clear;
clc;
close all;
T = @(hh) -31-0.000998*hh;%温度
phi = @(p,t) p/(0.1921*(t+273.15));%密度
p = @(hh) 0.699*exp(-0.00009*hh);%压强
q = @(pho, v) 0.5*pho*v^2;%动压

M=6.4171*10^23;
R=3396.2 * 1000;
G=6.67*(10^(-11));
g = M * G / (R^2);

T0=24*60*60+37*60+22.7;%同步轨道的周期
h1=((M*G*(T0^2))/(4*(pi^2)))^(1/3) - R;

m = 1285;
m_floor = 89.6;%火星着陆探测进入与减速段动力学问题研究
m_hide = 245.3;
m_para = 38;
S_floor = 2^2*pi;
S_para = 114;

v_yy=100;
v_xx=4700;
v0=sqrt(v_yy^2+v_xx^2);
v=[v0];
hh=100000;
dh=100;
        while hh >= 4000
            v_y = sqrt(v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*S_floor*dh*v_yy/m);
            
            v_x = sqrt(v_xx^2 - phi(p(hh),T(hh))*sqrt(v_xx^2 + v_yy^2)*S_floor*dh*v_xx^2 / (m * v_yy));
            
            hh = hh - dh;
            v_yy = v_y;
            v_xx = v_x;
            v0=sqrt(v_yy^2+v_xx^2);
            v=[v v0];
        end

        while hh >= 1000
            v_y = sqrt(v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*(S_floor+S_para)*dh*v_yy/m);
            if abs(v_y)<1  
                v_y = 1;
            end
            v_x = sqrt(v_xx^2 - phi(p(hh),T(hh))*sqrt(v_xx^2 + v_yy^2)*(S_floor+S_para)*dh*v_xx^2 / (m * v_yy));
            if abs(v_x)< 1
                v_x = 1;
            end
            hh = hh - dh;
            
            v_yy = v_y;
            v_xx = v_x;
            v0=sqrt(v_yy^2+v_xx^2);
            v=[v v0];
        end
v
h=10200:-100:1100;
plot(h,v(1,900:1:991),'k',4000,v(1,961),'-*')
xlabel('高度h（m）'),ylabel('速度v（m/s）')
\end{lstlisting}
\section{第二问MATLAB代码}
\subsection{求解代码}
\lstset{
    basicstyle=\sffamily,
    keywordstyle=\bfseries,
    commentstyle=\rmfamily\itshape,
    stringstyle=\ttfamily,
    columns=flexible,
    numbers=left,
    numberstyle=\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}
\begin{lstlisting}[language=Matlab]
clear;
clc;

%目标时间：单位（秒）
t = 20100; %本处为输入的t值
wucha = 0.5;
Emin = 99999999;

T = @(hh) -31 - 0.000998 * hh; %温度
phi = @(p, t) p / (0.1921 * (t + 273.15)); %密度
p = @(hh) 0.699 * exp(-0.00009 * hh); %压强
q = @(pho, v) 0.5 * pho * v^2; %动压

M = 6.4171 * 10^23;
R = 3396.2 * 1000;
G = 6.67 * (10^(-11));
g = M * G / (R^2);

T0 = 24 * 60 * 60 + 37 * 60 + 22.7; %同步轨道的周期
h1 = ((M * G * (T0^2)) / (4 * (pi^2)))^(1/3) - R;

m = 1285;
m_floor = 89.6; %火星着陆探测进入与减速段动力学问题研究
m_hide = 245.3;
m_para = 38;
S_floor = 2^2 * pi;
S_para = 114;

t1 = 0;
t2 = 0;
t3 = 0;
t4 = 0;
t5 = 0;
anst1 = -1;
anst2 = -1;
anst3 = -1;
anst4 = -1;
anst5 = -1;
ansh4 = 0;
ansh3 = 0;
ansh2 = 0;
ansh = 0;
%hmax = 4700;%待会计算完了进行更改
%hmin = 3990;%待会计算完了进行更改
hhmin = inf;

%clear all, clc;
%h1 = h1;
for h2 = 0:10000:100000
    %椭圆轨道的几何关系
    a = (h1 + h2 + 2 * R) / 2;
    c = (h1 - h2) / 2;
    b = sqrt(a^2 - c^2);
    T1 = 2 * pi * ((a^3) / (M * G))^(1/2); %椭圆轨道的周期
    diffk = @(x) -(b^2 * x) / (a^2 * (b^2 - (b^2 * x^2) / a^2)^(1/2)); %y对于x的求导函数

    for h = 100000:10000:200000
        %t1部分:
        x0 = abs((a^2 / c) - (a * (h + R)) / c);
        y = @(x)sqrt(abs(b^2 - (x .* b ./ a).^2));
        S = integral(y, -a, x0) - 0.5 * (x0 - c) * sqrt(y(x0));
        S_ = pi * a * b;
        t1 = S / S_ * T1;

        %t2部分
        t2 = 0;
        hh = h;
        dh = 100;
        k = diffk(x0);
        theta = acos((x0 - c + y(x0) * k) / (sqrt(x0^2 - 2 * x0 * c + c^2 + y(x0)^2) * sqrt(1 + k^2))) - pi / 18;
        v_0 = 2^(1/2) * ((G * M * (R + h1)) / ((R + h) * (2 * R + h + h1)))^(1/2);
        v_yy = sin(0.5 * pi - theta) * v_0;
        v_xx = cos(0.5 * pi - theta) * v_0;

        hh2 = hh;
        hmax = 0;
        hmin = inf;
        v_yy2 = v_yy; v_xx2 = v_xx;

        while hh2 >= 0
            v_y2 = sqrt(v_yy2^2 + 2 * g * dh - phi(p(hh2), T(hh2)) * sqrt(v_yy2^2 + v_xx2^2) * S_floor * dh * v_yy2 / m);

            if abs(v_y2) < 1
                v_y2 = 1;
            end

            v_x2 = sqrt(v_xx2^2 - phi(p(hh2), T(hh2)) * sqrt(v_xx2^2 + v_yy2^2) * S_floor * dh * v_xx2^2 / (m * v_yy2));

            if abs(v_x2) < 1
                v_x2 = 1;
            end

            hh2 = hh2 - dh;
            v_yy2 = v_y2;
            v_xx2 = v_x2;
            vc = sqrt(1.29 * (T(hh2) + 273.15) * 8.314472 * 1000/43.34);
            mahe = sqrt(v_x2^2 + v_y2^2) / vc;
            p_move = q(phi(p(hh2), T(hh2)), sqrt(v_xx2^2 + v_yy2^2));

            if mahe >= 1.6 && mahe <= 2.3 % && p_move <= 850 && p_move >= 250
                hmin = min(hmin, hh2);
                hmax = max(hmax, hh2);
            end

        end

        hmax = min(hmax, 15000);
        hmin = max(hmin, 4000);

        if hmax < hmin
            continue
        end

        for h3 = hmin:100:hmax

            while hh >= h3
                flagt2 = 10086;
                v_y = sqrt(v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_yy / m);

                if abs(v_y) < 1
                    v_y = 1;
                end

                v_x = sqrt(v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * S_floor * dh * v_xx^2 / (m * v_yy));

                if abs(v_x) < 1
                    v_x = 1;
                end

                hh = hh - dh;
                t2 = t2 + dh / ((v_y + v_yy) / 2);
                v_yy = v_y;
                v_xx = v_x;
            end

            %t3部分
            t3 = 0;

            while sqrt(v_yy^2 + v_xx^2) > 95
                %到速度减小到一定值时可以丢走降落伞,但这只是一个大的限制条件，更进一步的条件是马赫数
                v_y = sqrt(v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / m);

                if abs(v_y) < 1
                    v_y = 1;
                end

                v_x = sqrt(v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / (m * v_yy));

                if abs(v_x) < 1
                    v_x = 1;
                end

                hh = hh - dh;
                t3 = t3 + dh / ((v_y + v_yy) / 2);
                v_yy = v_y;
                v_xx = v_x;
                vc = sqrt(1.29 * (T(hh) + 273.15) * 8.314472 * 1000/43.34);
                mahe = sqrt(v_x^2 + v_y^2) / vc;
                %没错就是这里马赫数起到真正的限制作用,达到之后就可以丢掉大底了
                if mahe <= 0.6
                    h4 = hh;
                    break
                end

            end

            dh = 1;
            tmp_hh = hh;

            if t1 + t2 + t3 > t + wucha
                continue
            end

            %h5为抛掉降落伞的高度取值范围为100到h4

            for h5 = 100:10:h4
                %t4部分
                hh = tmp_hh;
                t4 = 0;

                while hh >= h5
                    tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / (m - m_floor);

                    if tmpvy2 < 1
                        tmpvy2 = 1;
                    end

                    v_y = sqrt(tmpvy2);
                    tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / ((m - m_floor) * v_yy);

                    if tmpvx2 < 0.1
                        tmpvx2 = 0;
                    end

                    v_x = sqrt(tmpvx2);
                    hh = hh - dh;
                    dt = dh / ((v_y + v_yy) / 2);
                    t4 = t4 + dt;
                    flag2 = 1;
                    v_yy = v_y;
                    v_xx = v_x;
                end

                if (v_yy^2 + v_xx^2) >= 95^2
                    continue;
                end

                tmp_hh2 = hh;

                for h6 = h5:1:h5
                    v_yy3 = v_yy;
                    v_xx3 = v_xx;
                    %t5部分预处理
                    hh = tmp_hh2;
                    %开发动机之前
                    while hh >= h6
                        tmpvy32 = v_yy3^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * (S_floor + S_para) * dh * v_yy3 / (m - m_floor - m_para - m_hide);

                        if tmpvy32 < 1
                            tmpvy32 = 1;
                        end

                        v_y3 = sqrt(tmpvy32);
                        tmpvx32 = v_xx3^2 - phi(p(hh), T(hh)) * sqrt(v_xx3^2 + v_yy3^2) * (S_floor + S_para) * dh * v_xx3^2 / ((m - m_floor - m_para - m_hide) * v_yy3);

                        if tmpvx32 < 0.1
                            tmpvx32 = 0;
                        end

                        v_x3 = sqrt(tmpvx32);
                        hh = hh - dh;
                        v_yy3 = v_y3;
                        v_xx3 = v_x3;
                    end

                    while hh >= 100
                        tmpvy32 = v_yy3^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * S_floor * dh * v_yy3 / (m - m_floor - m_para - m_hide) - 2 * 7500 * dh * v_yy3 / ((m - m_floor - m_para - m_hide) * sqrt(v_yy3^2 + v_xx3^2));
                        tmpvx32 = v_xx3^2 - phi(p(hh), T(hh)) * sqrt(v_yy3^2 + v_xx3^2) * S_floor * dh * v_xx3^2 / (v_yy3 * (m - m_floor - m_para - m_hide)) - 2 * 7500 * dh * v_xx3^2 / (v_yy3 * sqrt(v_yy3^2 + v_xx3^2) * (m - m_floor - m_para - m_hide));

                        if tmpvy32 < 1 && tmpvx32 < 1
                            hhmin = min(hhmin, h6);
                            break;
                        end

                        v_y3 = sqrt(tmpvy32);
                        v_x3 = sqrt(tmpvx32);
                        hh = hh - dh;
                        v_yy3 = v_y3;
                        v_xx3 = v_x3;
                    end

                    if v_yy3 > 1 || v_xx3 > 0
                        continue
                    end

                end

                %t5部分正式计算

                %开发动机的时间和抛掉降落伞的时间一致，并且最终速度减小到0.

                t5 = 0;
                dh = 0.1;
                hh = tmp_hh2;
                %开发动机之前
                while hh >= hhmin
                    tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * (S_floor + S_para) * dh * v_yy / (m - m_floor - m_para - m_hide);

                    if tmpvy2 < 1
                        tmpvy2 = 1;
                    end

                    v_y = sqrt(tmpvy2);
                    tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_xx^2 + v_yy^2) * (S_floor + S_para) * dh * v_xx^2 / ((m - m_floor - m_para - m_hide) * v_yy);

                    if tmpvx2 < 1
                        tmpvx2 = 1;
                    end

                    v_x = sqrt(tmpvx2);
                    hh = hh - dh;
                    dt = dh / ((v_y + v_yy) / 2);
                    t5 = t5 + dt;
                    v_yy = v_y;
                    v_xx = v_x;
                end

                %开发动机之后
                E = (v_xx^2 + v_yy^2) * (m - m_floor - m_para - m_hide) / 2 + (m - m_floor - m_para - m_hide) * g * hh;

                while hh >= 100
                    tmpvy2 = v_yy^2 + 2 * g * dh - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_yy / (m - m_floor - m_para - m_hide) - 2 * 7500 * dh * v_yy / ((m - m_floor - m_para - m_hide) * sqrt(v_yy^2 + v_xx^2));
                    tmpvx2 = v_xx^2 - phi(p(hh), T(hh)) * sqrt(v_yy^2 + v_xx^2) * S_floor * dh * v_xx^2 / (v_yy * (m - m_floor - m_para - m_hide)) - 2 * 7500 * dh * v_xx^2 / (v_yy * sqrt(v_yy^2 + v_xx^2) * (m - m_floor - m_para - m_hide));

                    if tmpvy2 < 1
                        tmpvy2 = 1;
                    end

                    v_y = sqrt(tmpvy2);

                    if tmpvx2 < 1
                        tmpvx2 = 1;
                    end

                    v_x = sqrt(tmpvx2);
                    dt = dh / ((v_y + v_yy) / 2);
                    t5 = t5 + dt;
                    hh = hh - dh;
                    v_yy = v_y;
                    v_xx = v_x;
                end

                if t1 == 0 || t2 == 0 || t3 == 0 || t4 == 0 || t5 == 0
                    continue
                end

                tmpt = t1 + t2 + t3 + t4 + t5
                delta_t = abs(tmpt - t);

                if delta_t <= wucha && E < Emin
                    answerT = tmpt;
                    ansh6 = h6;
                    ansh5 = h5;
                    ansh4 = h4;
                    ansh3 = h3;
                    ansh2 = h2;
                    ansh = h;
                    anshh = hh;
                    anst1 = t1;
                    anst2 = t2;
                    anst3 = t3;
                    anst4 = t4;
                    anst5 = t5;
                    Emin = E;
                    %1+1
                end

            end

        end

    end

end

answerT
ansh2 %近火点的高度
ansh %进入大气的高度
ansh3 %开启降落伞的高度
anst1
anst2
anst3
anst4
anst5
ansh4
ansh5
ansh6
Emin    
\end{lstlisting}
\subsection{绘图代码}
\lstset{
    basicstyle=\sffamily,
    keywordstyle=\bfseries,
    commentstyle=\rmfamily\itshape,
    stringstyle=\ttfamily,
    columns=flexible,
    numbers=left,
    numberstyle=\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}
\begin{lstlisting}[language=Matlab]
clc,clear;
x0=20100:20:20300;
y0=[4.439506026125528e+06 4.323742755370141e+06 4.181132954992451e+06 4.089111711446583e+06 3.999406693658655e+06 3.963666765054225e+06 3.959624858401800e+06 3.959624858401800e+06 3.959624858401800e+06 3.959624858401800e+06 3.959624858401800e+06]
cx=20100:0.1:20300;
y=interp1(x0,y0,cx,'spline');
plot(cx,y,'k')
xlabel('时间t（秒）'),ylabel('耗能E（焦耳）')
\end{lstlisting}
\section{第三问MATLAB代码}
\lstset{
    basicstyle=\sffamily,
    keywordstyle=\bfseries,
    commentstyle=\rmfamily\itshape,
    stringstyle=\ttfamily,
    columns=flexible,
    numbers=left,
    numberstyle=\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}
\begin{lstlisting}[language=Matlab]
clear;
clc;

%目标时间：单位（秒）
t=20100;
wucha=inf;
Emin=99999999;


T = @(hh) -31-0.000998*hh;%温度
phi = @(p,t) p/(0.1921*(t+273.15));%密度
p = @(hh) 0.699*exp(-0.00009*hh);%压强
q = @(pho, v) 0.5*pho*v^2;%动压

M=6.4171*10^23;
R=3396.2 * 1000;
G=6.67*(10^(-11));
g = M * G / (R^2);

T0=24*60*60+37*60+22.7;%同步轨道的周期
h1=((M*G*(T0^2))/(4*(pi^2)))^(1/3) - R;

m = 1285;
m_floor = 89.6;%火星着陆探测进入与减速段动力学问题研究
m_hide = 245.3;
m_para = 38;
S_floor = 2^2*pi;
S_para = 114;

t1 = 0;
t2 = 0;
t3 = 0;
t4 = 0;
t5 = 0;
anst1 = -1;
anst2 = -1;
anst3 = -1;
anst4 = -1;
anst5 = -1;
ansh4 = 0;
ansh3 = 0;
ansh2 = 0;
ansh = 0;


T2 = 279;   T34 = 168;     T5 = 90;

%clear all, clc;
%h1 = h1;
for h2 = 0:10000:100000
    %椭圆轨道的几何关系
    a = (h1 + h2 + 2*R) / 2;
    c = (h1 - h2) / 2;
    b = sqrt(a^2 - c^2);
    T1 = 2 * pi * ((a^3)/(M*G))^(1/2);%椭圆轨道的周期
    diffk = @(x) -(b^2*x)/(a^2*(b^2 - (b^2*x^2)/a^2)^(1/2));%y对于x的求导函数
    for h = 100000:10000:200000
%t1部分:
        x0 = abs((a^2/c) - (a*(h+R))/c);
        y = @(x)sqrt(abs(b^2 - (x.*b./a).^2));
        S = integral(y, -a, x0) - 0.5*(x0-c)*sqrt(y(x0));
        S_ = pi * a * b;
        t1 = S/S_ * T1;
        
%t2部分
        t2 = 0;
        hh = h;
        dh = 100;
        k = diffk(x0);
        theta = acos((x0 - c + y(x0)*k)/(sqrt(x0^2-2*x0*c+c^2+y(x0)^2)*sqrt(1+k^2))) - pi/18;
        v_0 = 2^(1/2)*((G*M*(R + h1))/((R + h)*(2*R + h + h1)))^(1/2);
        v_yy = sin(0.5*pi - theta) * v_0;
        v_xx = cos(0.5*pi - theta) * v_0;        
        
        hh2 = hh;
        hmax = 0;
        hmin = inf;
        v_yy2 = v_yy; v_xx2 = v_xx;
        while hh2 >= 0
            v_y2 = sqrt(v_yy2^2 + 2*g*dh - phi(p(hh2),T(hh2))*sqrt(v_yy2^2+v_xx2^2)*S_floor*dh*v_yy2/m);
            if abs(v_y2)<1  
                v_y2 = 1;
            end
            v_x2 = sqrt(v_xx2^2 - phi(p(hh2),T(hh2))*sqrt(v_xx2^2 + v_yy2^2)*S_floor*dh*v_xx2^2 / (m * v_yy2));
            if abs(v_x2)< 1
                v_x2 = 1;
            end
            hh2 = hh2 - dh;
            v_yy2 = v_y2;
            v_xx2 = v_x2;
            vc=sqrt(1.29*(T(hh2)+273.15)*8.314472*1000/43.34);
            mahe = sqrt(v_x2^2 + v_y2^2) / vc;
            p_move = q(phi(p(hh2),T(hh2)),sqrt(v_xx2^2+v_yy2^2));
            if mahe >= 1.6 && mahe <= 2.3% && p_move <= 850 && p_move >= 250
                hmin = min(hmin, hh2);
                hmax = max(hmax, hh2);
            end
        end
        hmax = min(hmax, 15000);
        hmin = max(hmin, 4000);
        
        if hmax<hmin
            continue
        end
        
        for h3 = hmin:100:hmax

            while hh >= h3
                flagt2 = 10086;
                v_y = sqrt(v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*S_floor*dh*v_yy/m);
                if abs(v_y)<1  
                    v_y = 1;
                end
                v_x = sqrt(v_xx^2 - phi(p(hh),T(hh))*sqrt(v_xx^2 + v_yy^2)*S_floor*dh*v_xx^2 / (m * v_yy));
                if abs(v_x)< 1
                    v_x = 1;
                end
                hh = hh - dh;
                t2 = t2 + dh / ((v_y+v_yy)/2);
                v_yy = v_y;
                v_xx = v_x;
            end
            
            tmpdt2 = abs(t2 - T2);

%t3部分
            t3 = 0;
            while sqrt(v_yy^2 + v_xx^2) > 95 
            %到速度减小到一定值时可以丢走降落伞,但这只是一个大的限制条件，更进一步的条件是马赫数
                v_y = sqrt(v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*(S_floor+S_para)*dh*v_yy/m);
                if abs(v_y)<1  
                    v_y = 1;
                end
                v_x = sqrt(v_xx^2 - phi(p(hh),T(hh))*sqrt(v_xx^2 + v_yy^2)*(S_floor+S_para)*dh*v_xx^2 / (m * v_yy));
                if abs(v_x)< 1
                    v_x = 1;
                end
                hh = hh - dh;
                t3 = t3 + dh / ((v_y+v_yy)/2);
                v_yy = v_y;
                v_xx = v_x;         
                vc=sqrt(1.29*(T(hh)+273.15)*8.314472*1000/43.34);
                mahe = sqrt(v_x^2 + v_y^2) / vc;
            %没错就是这里马赫数起到真正的限制作用,达到之后就可以丢掉大底了
                if mahe <= 0.6
                    h4 = hh;
                    break
                end
            end

            dh = 1;
            tmp_hh = hh;
        
        
%h5为抛掉降落伞的高度取值范围为100到h4
        
            for h5=100:10:h4
%t4部分
                hh = tmp_hh;
                t4 = 0;
                while hh >= h5               
                    tmpvy2 = v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*(S_floor+S_para)*dh*v_yy/(m-m_floor);
                    if tmpvy2 < 1  
                        tmpvy2 = 1;
                    end
                    v_y = sqrt(tmpvy2);
                    tmpvx2 = v_xx^2 - phi(p(hh),T(hh))*sqrt(v_xx^2 + v_yy^2)*(S_floor+S_para)*dh*v_xx^2 / ((m-m_floor) * v_yy);
                    if tmpvx2 < 0.1
                        tmpvx2 = 0;
                    end
                    v_x = sqrt(tmpvx2);
                    hh = hh - dh;
                    dt =  dh / ((v_y+v_yy)/2);
                    t4 = t4 + dt;
                    flag2 = 1;
                    v_yy = v_y;
                    v_xx = v_x;         
                end

                if (v_yy^2 + v_xx^2) >= 95^2 
                    continue;
                end

                tmp_hh2 = hh;

                tmpdt34 = abs(t3+t4-T34);

%t5部分正式计算     
%开发动机的时间和抛掉降落伞的时间一致，并且最终速度减小到0.


                t5 = 0;
                dh = 0.1;
                hh = tmp_hh2;

            %开发动机之后 
                E=(v_xx^2+v_yy^2)*(m-m_floor-m_para-m_hide)/2+(m-m_floor-m_para-m_hide)*g*hh;
                while hh >= 100
                    tmpvy2 = v_yy^2 + 2*g*dh - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*S_floor*dh*v_yy/(m-m_floor-m_para-m_hide) - 2*7500*dh*v_yy/((m-m_floor-m_para-m_hide)*sqrt(v_yy^2+v_xx^2));
                    tmpvx2 = v_xx^2 - phi(p(hh),T(hh))*sqrt(v_yy^2+v_xx^2)*S_floor*dh*v_xx^2/(v_yy*(m-m_floor-m_para-m_hide))-2*7500*dh*v_xx^2/(v_yy*sqrt(v_yy^2+v_xx^2)*(m-m_floor-m_para-m_hide));
                    if tmpvy2 < 2.25  
                        tmpvy2 = 2.25;
                    end
                    v_y = sqrt(tmpvy2);
                    if tmpvx2 < 0.1  
                        tmpvx2 = 0;
                    end
                    v_x = sqrt(tmpvx2);
                    dt =  dh / ((v_y+v_yy)/2);
                    t5 = t5 + dt;
                    hh = hh - dh;
                    v_yy = v_y;
                    v_xx = v_x;      
                end
                if hh < 100 - dh
                    continue
                end
                t5 = t5 + (hh - 100)/1.5;
                tmpdt5 = abs(t5 - T5);
                
                if t1==0||t2==0||t3==0||t4==0||t5==0
                    continue
                end
                
                tmpdt = tmpdt2 + tmpdt34 + tmpdt5;
                if tmpdt < wucha
                    wucha = tmpdt;
                    ansh2 = h2;
                    ansh3 = h3;
                    ansh4 = h4;
                    ansh5 = h5;
                    anst1 = t1;
                    anst2 = t2;
                    anst3 = t3;
                    anst4 = t4;
                    anst5 = t5;
                end
            end
        end 
    end
end
wucha
ansh2
ansh3
ansh4
ansh5
anst1
anst2
anst3
anst4
anst5
\end{lstlisting}
\end{document}